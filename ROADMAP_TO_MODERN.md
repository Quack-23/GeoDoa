# üöÄ ROADMAP TO MODERN FLUTTER APP
## Target: 6.0/10 ‚Üí 7.5/10 (Standar Production-Ready Modern App)

---

## üìã **EXECUTIVE SUMMARY**

**Current Score:** 6.0/10 (Semi-Modern)
**Target Score:** 7.5/10 (Modern & Production-Ready)
**Timeline:** 4-6 minggu
**Priority:** WAJIB untuk production deployment

---

## üéØ **PHASE 1: ARCHITECTURE RESTRUCTURING** (2 minggu)
**Impact:** +0.8 score | Priority: üî¥ CRITICAL

### **1.1 Implement Clean Architecture atau MVVM** ‚úÖ WAJIB
**Current Problem:**
- No clear separation of concerns
- Business logic tercampur di UI layer
- Hard to test & maintain

**Action Items:**
```
‚úÖ [ ] Create folder structure:
      lib/
      ‚îú‚îÄ‚îÄ data/
      ‚îÇ   ‚îú‚îÄ‚îÄ datasources/  (API, Database, SharedPrefs)
      ‚îÇ   ‚îú‚îÄ‚îÄ repositories/  (Implementation)
      ‚îÇ   ‚îî‚îÄ‚îÄ models/        (Data models)
      ‚îú‚îÄ‚îÄ domain/
      ‚îÇ   ‚îú‚îÄ‚îÄ entities/      (Business objects)
      ‚îÇ   ‚îú‚îÄ‚îÄ repositories/  (Interfaces)
      ‚îÇ   ‚îî‚îÄ‚îÄ usecases/      (Business logic)
      ‚îî‚îÄ‚îÄ presentation/
          ‚îú‚îÄ‚îÄ screens/
          ‚îú‚îÄ‚îÄ viewmodels/    (State + Logic)
          ‚îî‚îÄ‚îÄ widgets/

‚úÖ [ ] Migrate LocationService ke Clean Architecture:
      - Create LocationRepository interface
      - Create LocationRepositoryImpl
      - Create GetCurrentLocation use case
      - Create LocationViewModel

‚úÖ [ ] Migrate DatabaseService ke Repository pattern:
      - Create PrayerRepository
      - Create LocationRepository
      - Separate data source dari business logic

‚úÖ [ ] Extract UI logic dari StatefulWidgets:
      - HomeScreen ‚Üí HomeViewModel
      - PrayerScreen ‚Üí PrayerViewModel
      - ProfileScreen ‚Üí ProfileViewModel
```

**Success Criteria:**
- ‚úÖ Clear 3-layer separation (Data, Domain, Presentation)
- ‚úÖ Business logic di use cases, NOT di widgets
- ‚úÖ Easy to swap implementations

**Files to Refactor:**
- `lib/services/location_service.dart` ‚Üí Repository
- `lib/services/database_service.dart` ‚Üí Repository
- `lib/screens/home_screen.dart` ‚Üí Extract ViewModel
- `lib/screens/prayer_screen.dart` ‚Üí Extract ViewModel

---

### **1.2 Consolidate Services** ‚úÖ WAJIB
**Current Problem:**
- 32 services (TOO MANY!)
- Overlapping responsibilities
- Hard to maintain

**Action Items:**
```
‚úÖ [ ] Merge Offline Services (3 ‚Üí 1):
      - offline_service.dart
      - offline_data_sync_service.dart
      - data_backup_service.dart
      ‚Üí Feature module: lib/features/offline/

‚úÖ [ ] Merge State Services (3 ‚Üí 1):
      - state_management_service.dart
      - persistent_state_service.dart
      - state_restoration_service.dart
      ‚Üí lib/domain/state/app_state_manager.dart

‚úÖ [ ] Merge Location Services (2 ‚Üí 1):
      - location_service.dart
      - location_scan_service.dart
      ‚Üí lib/features/location/location_repository.dart

‚úÖ [ ] Create Feature Modules:
      lib/features/
      ‚îú‚îÄ‚îÄ authentication/
      ‚îú‚îÄ‚îÄ location/
      ‚îú‚îÄ‚îÄ prayer/
      ‚îú‚îÄ‚îÄ notifications/
      ‚îî‚îÄ‚îÄ settings/
```

**Target:** 32 services ‚Üí 12-15 feature modules

**Success Criteria:**
- ‚úÖ Each feature is self-contained
- ‚úÖ Clear boundaries between features
- ‚úÖ Easier to navigate codebase

---

### **1.3 Extract ViewModels** ‚úÖ WAJIB
**Current Problem:**
- setState() everywhere
- 500+ line StatefulWidgets
- Business logic di UI layer

**Action Items:**
```
‚úÖ [ ] Create base ViewModel:
      class BaseViewModel extends ChangeNotifier {
        bool _isLoading = false;
        String? _error;
        
        bool get isLoading => _isLoading;
        String? get error => _error;
        
        Future<void> execute(Future<void> Function() action) async {
          _isLoading = true;
          _error = null;
          notifyListeners();
          try {
            await action();
          } catch (e) {
            _error = e.toString();
          } finally {
            _isLoading = false;
            notifyListeners();
          }
        }
      }

‚úÖ [ ] Extract HomeScreen logic:
      - Create HomeViewModel
      - Move _scanNearbyLocations ‚Üí scanNearbyLocations()
      - Move _loadPersistentState ‚Üí loadState()
      - Widget only handles UI

‚úÖ [ ] Extract PrayerScreen logic:
      - Create PrayerViewModel
      - Move _loadPrayers ‚Üí loadPrayers()
      - Move _filteredPrayers ‚Üí computed property

‚úÖ [ ] Extract ProfileScreen logic:
      - Create ProfileViewModel
      - Move _saveProfile ‚Üí saveProfile()
      - Move _loadProfile ‚Üí loadProfile()
```

**Success Criteria:**
- ‚úÖ Widgets < 300 lines
- ‚úÖ No business logic di build() method
- ‚úÖ Easy to test ViewModels

---

## üß™ **PHASE 2: TESTING INFRASTRUCTURE** (1.5 minggu)
**Impact:** +0.5 score | Priority: üî¥ CRITICAL

### **2.1 Setup Testing Infrastructure** ‚úÖ WAJIB
**Current Problem:**
- ZERO tests
- No testing culture
- Production bugs

**Action Items:**
```
‚úÖ [ ] Create test folder structure:
      test/
      ‚îú‚îÄ‚îÄ unit/
      ‚îÇ   ‚îú‚îÄ‚îÄ data/
      ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repositories/
      ‚îÇ   ‚îú‚îÄ‚îÄ domain/
      ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usecases/
      ‚îÇ   ‚îî‚îÄ‚îÄ presentation/
      ‚îÇ       ‚îî‚îÄ‚îÄ viewmodels/
      ‚îú‚îÄ‚îÄ widget/
      ‚îÇ   ‚îî‚îÄ‚îÄ screens/
      ‚îî‚îÄ‚îÄ integration/
          ‚îî‚îÄ‚îÄ flows/

‚úÖ [ ] Add testing dependencies:
      dev_dependencies:
        mockito: ^5.4.4
        build_runner: ^2.4.8
        flutter_test:
          sdk: flutter

‚úÖ [ ] Create test helpers:
      test/helpers/
      ‚îú‚îÄ‚îÄ mock_services.dart
      ‚îú‚îÄ‚îÄ test_data.dart
      ‚îî‚îÄ‚îÄ widget_tester_extension.dart
```

---

### **2.2 Write Unit Tests** ‚úÖ WAJIB
**Target:** Minimal 60% code coverage

**Action Items:**
```
‚úÖ [ ] Test critical services:
      test/unit/
      ‚îú‚îÄ‚îÄ database_service_test.dart (WAJIB)
      ‚îú‚îÄ‚îÄ location_repository_test.dart (WAJIB)
      ‚îú‚îÄ‚îÄ prayer_repository_test.dart (WAJIB)
      ‚îî‚îÄ‚îÄ notification_service_test.dart

‚úÖ [ ] Test ViewModels:
      test/unit/presentation/viewmodels/
      ‚îú‚îÄ‚îÄ home_viewmodel_test.dart (WAJIB)
      ‚îú‚îÄ‚îÄ prayer_viewmodel_test.dart (WAJIB)
      ‚îî‚îÄ‚îÄ profile_viewmodel_test.dart

‚úÖ [ ] Test Use Cases:
      test/unit/domain/usecases/
      ‚îú‚îÄ‚îÄ get_current_location_test.dart
      ‚îú‚îÄ‚îÄ scan_nearby_locations_test.dart
      ‚îî‚îÄ‚îÄ get_prayers_by_type_test.dart

Example:
void main() {
  group('HomeViewModel', () {
    late HomeViewModel viewModel;
    late MockLocationRepository mockRepo;
    
    setUp(() {
      mockRepo = MockLocationRepository();
      viewModel = HomeViewModel(mockRepo);
    });
    
    test('scanNearbyLocations should update locations', () async {
      // Arrange
      final locations = [/* test data */];
      when(mockRepo.getNearby(any))
          .thenAnswer((_) async => locations);
      
      // Act
      await viewModel.scanNearbyLocations();
      
      // Assert
      expect(viewModel.locations, equals(locations));
      expect(viewModel.isLoading, false);
    });
  });
}
```

**Success Criteria:**
- ‚úÖ 60%+ code coverage
- ‚úÖ All critical paths tested
- ‚úÖ Fast test execution (< 10s)

---

### **2.3 Write Widget Tests** ‚úÖ WAJIB
**Action Items:**
```
‚úÖ [ ] Test main screens:
      test/widget/screens/
      ‚îú‚îÄ‚îÄ home_screen_test.dart (WAJIB)
      ‚îú‚îÄ‚îÄ prayer_screen_test.dart (WAJIB)
      ‚îî‚îÄ‚îÄ profile_screen_test.dart

Example:
void main() {
  testWidgets('HomeScreen shows scan button', (tester) async {
    // Arrange
    await tester.pumpWidget(MaterialApp(
      home: MultiProvider(
        providers: [
          ChangeNotifierProvider(
            create: (_) => MockHomeViewModel(),
          ),
        ],
        child: const HomeScreen(),
      ),
    ));
    
    // Assert
    expect(find.text('Scan'), findsOneWidget);
    expect(find.byIcon(Icons.radar), findsOneWidget);
  });
}
```

**Success Criteria:**
- ‚úÖ Main user flows tested
- ‚úÖ Critical UI elements verified
- ‚úÖ No widget rendering errors

---

## üîß **PHASE 3: DEPENDENCY INJECTION** (1 minggu)
**Impact:** +0.3 score | Priority: üü° IMPORTANT

### **3.1 Setup DI Framework** ‚úÖ WAJIB

**Action Items:**
```
‚úÖ [ ] Add get_it package:
      dependencies:
        get_it: ^7.6.7

‚úÖ [ ] Create service locator:
      lib/core/di/injection.dart

      final getIt = GetIt.instance;

      void setupDependencies() {
        // Repositories
        getIt.registerLazySingleton<LocationRepository>(
          () => LocationRepositoryImpl(
            dataSource: getIt(),
          ),
        );
        
        // UseCases
        getIt.registerFactory(
          () => GetCurrentLocation(getIt()),
        );
        
        // ViewModels
        getIt.registerFactory(
          () => HomeViewModel(getIt()),
        );
      }

‚úÖ [ ] Initialize di main.dart:
      void main() async {
        WidgetsFlutterBinding.ensureInitialized();
        await setupDependencies();
        runApp(MyApp());
      }

‚úÖ [ ] Refactor all Singleton services:
      // Before ‚ùå
      LocationService.instance
      
      // After ‚úÖ
      getIt<LocationRepository>()
```

**Success Criteria:**
- ‚úÖ No more `.instance` calls
- ‚úÖ Easy to swap implementations
- ‚úÖ Testable with mocks

---

## ‚ö†Ô∏è **PHASE 4: ERROR HANDLING** (3 hari)
**Impact:** +0.2 score | Priority: üü° IMPORTANT

### **4.1 Implement Result Pattern** ‚úÖ WAJIB

**Action Items:**
```
‚úÖ [ ] Create Result class:
      lib/core/utils/result.dart

      class Result<T> {
        final T? data;
        final AppError? error;
        
        bool get isSuccess => error == null;
        bool get isFailure => error != null;
        
        Result.success(this.data) : error = null;
        Result.failure(this.error) : data = null;
      }

‚úÖ [ ] Refactor repository methods:
      // Before ‚ùå
      Future<List<Prayer>> getPrayers() async {
        return await database.query(...);
      }
      
      // After ‚úÖ
      Future<Result<List<Prayer>>> getPrayers() async {
        try {
          final data = await database.query(...);
          return Result.success(data);
        } catch (e) {
          return Result.failure(AppError.from(e));
        }
      }

‚úÖ [ ] Update ViewModels to handle Result:
      final result = await repository.getPrayers();
      if (result.isSuccess) {
        _prayers = result.data!;
      } else {
        _error = result.error!.message;
      }
```

---

### **4.2 Setup Firebase Crashlytics** ‚úÖ WAJIB

**Action Items:**
```
‚úÖ [ ] Add Firebase dependencies:
      dependencies:
        firebase_core: ^2.24.2
        firebase_crashlytics: ^3.4.9

‚úÖ [ ] Initialize Firebase:
      void main() async {
        WidgetsFlutterBinding.ensureInitialized();
        await Firebase.initializeApp();
        
        FlutterError.onError = 
          FirebaseCrashlytics.instance.recordFlutterFatalError;
        
        runApp(MyApp());
      }

‚úÖ [ ] Add error reporting:
      catch (e, stackTrace) {
        await FirebaseCrashlytics.instance.recordError(
          e, 
          stackTrace,
          reason: 'Failed to load prayers',
        );
      }
```

---

### **4.3 Global Error Boundary** ‚úÖ WAJIB

**Action Items:**
```
‚úÖ [ ] Create ErrorBoundary widget:
      class ErrorBoundary extends StatelessWidget {
        final Widget child;
        
        Widget build(BuildContext context) {
          return MaterialApp(
            builder: (context, widget) {
              ErrorWidget.builder = (details) {
                return ErrorScreen(error: details.exception);
              };
              return widget!;
            },
            home: child,
          );
        }
      }
```

---

## üîÑ **PHASE 5: STATE MANAGEMENT UPGRADE** (1 minggu)
**Impact:** +0.3 score | Priority: üü¢ RECOMMENDED

### **5.1 Migrate Complex State ke Riverpod/BLoC** ‚úÖ RECOMMENDED

**Action Items:**
```
‚úÖ [ ] Choose state solution:
      Option A: Riverpod (Recommended)
      Option B: BLoC pattern

‚úÖ [ ] Migrate LocationService:
      // Riverpod approach
      final locationProvider = StateNotifierProvider<
        LocationNotifier, 
        LocationState
      >((ref) {
        return LocationNotifier(ref.read(locationRepositoryProvider));
      });

‚úÖ [ ] Migrate complex screens:
      - HomeScreen (Scan functionality)
      - BackgroundScanScreen (Timer management)
      - ProfileScreen (Multiple state pieces)
```

**Success Criteria:**
- ‚úÖ Predictable state updates
- ‚úÖ Better dev tools
- ‚úÖ Easier debugging

---

## üìù **PHASE 6: CODE QUALITY** (3 hari)
**Impact:** +0.2 score | Priority: üü¢ RECOMMENDED

### **6.1 Setup Strict Linting** ‚úÖ WAJIB

**Action Items:**
```
‚úÖ [ ] Enable strict analysis:
      analysis_options.yaml
      
      include: package:flutter_lints/flutter.yaml
      
      linter:
        rules:
          - always_declare_return_types
          - prefer_const_constructors
          - prefer_final_fields
          - avoid_print
          - prefer_single_quotes
          - sort_pub_dependencies

‚úÖ [ ] Fix all warnings:
      flutter analyze --no-fatal-infos
      
‚úÖ [ ] Setup pre-commit hook:
      .git/hooks/pre-commit
      #!/bin/sh
      flutter analyze
      flutter test
```

---

### **6.2 Add Documentation** ‚úÖ RECOMMENDED

**Action Items:**
```
‚úÖ [ ] Document public APIs:
      /// Gets the current user location.
      /// 
      /// Returns [Result] containing [Position] if successful,
      /// or [AppError] if location services are disabled.
      /// 
      /// Throws [PermissionDeniedException] if permission denied.
      Future<Result<Position>> getCurrentLocation();

‚úÖ [ ] Add README sections:
      - Architecture overview
      - Setup instructions
      - Testing guide
      - Contributing guidelines
```

---

## üìä **SCORING BREAKDOWN**

| Phase | Impact | New Score |
|-------|--------|-----------|
| **Current** | - | 6.0/10 |
| Phase 1: Architecture | +0.8 | 6.8/10 |
| Phase 2: Testing | +0.5 | 7.3/10 |
| Phase 3: DI | +0.3 | 7.6/10 |
| Phase 4: Error Handling | +0.2 | 7.8/10 |
| Phase 5: State Upgrade | +0.3 | 8.1/10 |
| Phase 6: Code Quality | +0.2 | 8.3/10 |

**Target minimal: 7.5/10** ‚úÖ
**Realistic target: 7.8/10** üéØ

---

## ‚è±Ô∏è **TIMELINE ESTIMASI**

```
Week 1-2:  Architecture Restructuring
  ‚îú‚îÄ Implement Clean Architecture
  ‚îú‚îÄ Consolidate services
  ‚îî‚îÄ Extract ViewModels

Week 3-4:  Testing Infrastructure
  ‚îú‚îÄ Setup test framework
  ‚îú‚îÄ Write unit tests (60% coverage)
  ‚îî‚îÄ Write widget tests

Week 5:    Dependency Injection
  ‚îú‚îÄ Setup get_it
  ‚îî‚îÄ Refactor all services

Week 6:    Error Handling & Polish
  ‚îú‚îÄ Result pattern
  ‚îú‚îÄ Firebase Crashlytics
  ‚îú‚îÄ Strict linting
  ‚îî‚îÄ Documentation

TOTAL: 6 weeks (1.5 bulan)
```

---

## üéØ **SUCCESS METRICS**

### **Must Have (Target 7.5/10):**
- ‚úÖ Clean Architecture implemented
- ‚úÖ 60%+ test coverage
- ‚úÖ Dependency injection working
- ‚úÖ All critical services refactored
- ‚úÖ Zero linter warnings

### **Nice to Have (Target 8.0+/10):**
- ‚úÖ 80%+ test coverage
- ‚úÖ Full Riverpod/BLoC migration
- ‚úÖ CI/CD pipeline
- ‚úÖ Comprehensive documentation

---

## üìã **CHECKLIST PRIORITAS**

### **üî¥ CRITICAL (WAJIB - Target 7.5/10)**
- [ ] Implement Clean Architecture/MVVM
- [ ] Consolidate 32 services ‚Üí 15 modules
- [ ] Extract ViewModels dari screens
- [ ] Write unit tests (60% coverage)
- [ ] Setup dependency injection
- [ ] Implement Result pattern
- [ ] Setup Firebase Crashlytics
- [ ] Fix all linter warnings

### **üü° IMPORTANT (Recommended - Bonus 0.3)**
- [ ] Widget tests untuk main flows
- [ ] Migrate complex state ke Riverpod
- [ ] Integration tests
- [ ] Documentation

### **üü¢ NICE TO HAVE (Future)**
- [ ] CI/CD pipeline
- [ ] Performance monitoring
- [ ] Analytics integration
- [ ] 80%+ test coverage

---

## üöÄ **GETTING STARTED**

### **Step 1: Create feature structure**
```bash
mkdir -p lib/features/{location,prayer,profile,settings}
mkdir -p lib/core/{di,utils,constants}
mkdir -p lib/data/{datasources,repositories,models}
mkdir -p lib/domain/{entities,repositories,usecases}
mkdir -p lib/presentation/{screens,viewmodels,widgets}
```

### **Step 2: Setup testing**
```bash
mkdir -p test/{unit,widget,integration}
flutter pub add --dev mockito build_runner
```

### **Step 3: Add dependencies**
```bash
flutter pub add get_it
flutter pub add firebase_core firebase_crashlytics
```

### **Step 4: Start refactoring**
```
1. Pick one feature (misal: Prayer)
2. Refactor ke Clean Architecture
3. Write tests
4. Repeat untuk feature lain
```

---

## ‚úÖ **DEFINITION OF DONE**

Aplikasi dianggap **Modern & Production-Ready** jika:

1. ‚úÖ **Architecture**: Clear 3-layer separation
2. ‚úÖ **Testing**: 60%+ coverage, all critical paths tested
3. ‚úÖ **DI**: No singleton pattern, all injected
4. ‚úÖ **Error Handling**: Result pattern + Crashlytics
5. ‚úÖ **Code Quality**: Zero warnings, documented
6. ‚úÖ **State Management**: Predictable & testable
7. ‚úÖ **Performance**: Fast startup, no memory leaks
8. ‚úÖ **Maintainability**: Easy to understand & extend

**Target Score:** 7.5-8.0/10 üéØ

---

**Last Updated:** 2024
**Status:** Ready for implementation
**Owner:** Development Team

